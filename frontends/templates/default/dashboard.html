<!-- frontends/templates/default/dashboard.html -->
{% extends 'base.html' %}
{% load static i18n %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'base/css/dashboard.css' %}">
{% block extra_head_dashboard %}{% endblock %}
{% endblock %}

{% block header %}
<!-- Không có header ở đây -->
{% endblock %}

{% block main %}
<div class="dashboard-wrapper">
  <!-- Sidebar -->
  {% block sidebar %}
  {% include 'studies/study_43en/sidebar.html' %}
  {% endblock %}

  <!-- Sidebar Overlay for Mobile -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- Main Content -->
  <main class="dashboard-content" id="mainContent">
    <!-- Navbar bên trong main content -->
    {% include 'includes/header/dashboard_header.html' %}
    
    <!-- Messages Section -->
    {% if messages %}
    <div class="container-fluid px-4 pt-3">
      {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show auto-dismiss-alert" role="alert">
        <i class="fas fa-{% if message.tags == 'success' %}check-circle{% elif message.tags == 'error' or message.tags == 'danger' %}exclamation-circle{% elif message.tags == 'warning' %}exclamation-triangle{% else %}info-circle{% endif %} me-2"></i>
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        <!-- Progress bar for auto-dismiss -->
        <div class="alert-progress">
          <div class="alert-progress-bar"></div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}
    
    <!-- Content Area -->
    <div class="container-fluid p-4">
      {% block dashboard_content %}
      <!-- Content will be injected here -->
      {% endblock %}
    </div>
  </main>
</div>
{% endblock %}

{% block extra_js %}
<script nonce="{{ request.csp_nonce }}" src="{% static 'base/js/dashboard.js' %}"></script>

<!-- Auto-dismiss alerts -->
<script nonce="{{ request.csp_nonce }}">
(function() {
  'use strict';
  
  const AUTO_DISMISS_DELAY = 5000; // 5 seconds
  
  document.addEventListener('DOMContentLoaded', function() {
    const alerts = document.querySelectorAll('.auto-dismiss-alert');
    
    alerts.forEach(function(alert, index) {
      // Stagger the start time for multiple alerts
      const delay = index * 500;
      
      setTimeout(function() {
        // Start progress bar animation
        const progressBar = alert.querySelector('.alert-progress-bar');
        if (progressBar) {
          progressBar.style.animation = `alertProgress ${AUTO_DISMISS_DELAY}ms linear forwards`;
        }
        
        // Auto dismiss after delay
        setTimeout(function() {
          if (alert && alert.parentNode) {
            // Add fade out animation
            alert.style.animation = 'alertFadeOut 0.3s ease-out forwards';
            
            // Remove from DOM after animation
            setTimeout(function() {
              if (alert.parentNode) {
                alert.parentNode.removeChild(alert);
              }
            }, 300);
          }
        }, AUTO_DISMISS_DELAY);
      }, delay);
      
      // Pause on hover
      alert.addEventListener('mouseenter', function() {
        const progressBar = alert.querySelector('.alert-progress-bar');
        if (progressBar) {
          progressBar.style.animationPlayState = 'paused';
        }
      });
      
      alert.addEventListener('mouseleave', function() {
        const progressBar = alert.querySelector('.alert-progress-bar');
        if (progressBar) {
          progressBar.style.animationPlayState = 'running';
        }
      });
    });
  });
})();
</script>

{% block extra_js_dashboard %}{% endblock %}
{% endblock %}