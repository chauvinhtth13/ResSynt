{% extends "study_43en/base_43en.html" %}
{% load static %}
{% load i18n %}

{% block title %}{% trans 'Xóa người tiếp xúc' %}{% endblock %}

{% block page_title %}{% trans 'Xóa người tiếp xúc' %}{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'admin_dashboard' %}">{% trans "Dashboard" %}</a></li>
<li class="breadcrumb-item"><a href="{% url 'screening_contact_list' %}">{% trans "Người tiếp xúc" %}</a></li>
<li class="breadcrumb-item active">{% trans "Xóa" %}</li>
{% endblock %}

{% block dashboard_content %}
<div class="row">
  <div class="col-12">
    <div class="card card-danger">
      <div class="card-header">
        <h3 class="card-title"><i class="fas fa-exclamation-triangle mr-2"></i>{% trans 'Xác nhận xóa' %}</h3>
      </div>
      <div class="card-body">
        <div class="alert alert-warning">
          <h5><i class="icon fas fa-exclamation-triangle"></i> {% trans 'Cảnh báo!' %}</h5>
          <p>{% trans 'Bạn có chắc chắn muốn xóa người tiếp xúc này không? Hành động này không thể hoàn tác.' %}</p>
        </div>
        
        <div class="row">
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">{% trans 'Thông tin người tiếp xúc' %}</h3>
              </div>
              <div class="card-body">
                <dl class="row">
                  <dt class="col-sm-4">{% trans 'Mã sàng lọc' %}</dt>
                  <dd class="col-sm-8">{{ contact.SCRID }}</dd>
                  
                  {% if contact.USUBJID %}
                  <dt class="col-sm-4">{% trans 'USUBJID' %}</dt>
                  <dd class="col-sm-8">{{ contact.USUBJID }}</dd>
                  {% endif %}
                  
                  <dt class="col-sm-4">{% trans 'Tên viết tắt' %}</dt>
                  <dd class="col-sm-8">{{ contact.INITIAL }}</dd>
                  
                  <dt class="col-sm-4">{% trans 'Bệnh nhân liên quan' %}</dt>
                  <dd class="col-sm-8">
                    <strong>{{ contact.SUBJIDENROLLSTUDY.INITIAL }} ({{ contact.SUBJIDENROLLSTUDY.USUBJID }})</strong>
                    <br><small class="text-muted">
                      {% trans "Tổng số người tiếp xúc của bệnh nhân này" %}: {{ contact.SUBJIDENROLLSTUDY.contacts.count }}
                    </small>
                  </dd>
                </dl>
              </div>
            </div>
          </div>
          
          <!-- Hiển thị tất cả người tiếp xúc của bệnh nhân này -->
          {% if contact.SUBJIDENROLLSTUDY.contacts.count > 1 %}
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">{% trans 'Tất cả người tiếp xúc của bệnh nhân' %}</h3>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-sm">
                    <thead>
                      <tr>
                        <th>{% trans 'Mã sàng lọc' %}</th>
                        <th>{% trans 'Tên viết tắt' %}</th>
                        <th>{% trans 'USUBJID' %}</th>
                        <th>{% trans 'Trạng thái' %}</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for other_contact in contact.SUBJIDENROLLSTUDY.contacts.all %}
                      <tr {% if other_contact.SCRID == contact.SCRID %}class="table-danger"{% endif %}>
                        <td>{{ other_contact.SCRID }}</td>
                        <td>{{ other_contact.INITIAL }}</td>
                        <td>{{ other_contact.USUBJID|default:"-" }}</td>
                        <td>
                          {% if other_contact.SCRID == contact.SCRID %}
                            <span class="badge badge-danger">{% trans 'Sẽ xóa' %}</span>
                          {% else %}
                            <span class="badge badge-success">{% trans 'Hoạt động' %}</span>
                          {% endif %}
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          {% endif %}
        </div>
        
        <!-- Thống kê tổng quan -->
        <div class="row mt-3">
          <div class="col-12">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">{% trans 'Thống kê tổng quan' %}</h3>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-4">
                    <div class="info-box">
                      <span class="info-box-icon bg-info"><i class="fas fa-users"></i></span>
                      <div class="info-box-content">
                        <span class="info-box-text">{% trans 'Tổng số bệnh nhân' %}</span>
                        <span class="info-box-number">{{ total_patients|default:"0" }}</span>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="info-box">
                      <span class="info-box-icon bg-success"></span>
                      <div class="info-box-content">
                        <span class="info-box-text">{% trans 'Tổng số người tiếp xúc' %}</span>
                        <span class="info-box-number">{{ total_contacts|default:"0" }}</span>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="info-box">
                      <span class="info-box-icon bg-warning"><i class="fas fa-user-check"></i></span>
                      <div class="info-box-content">
                        <span class="info-box-text">{% trans 'Người tiếp xúc đủ điều kiện' %}</span>
                        <span class="info-box-number">{{ eligible_contacts|default:"0" }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Form xác nhận xóa -->
        <form method="post">
          {% csrf_token %}
          <div class="row mt-4">
            <div class="col-12">
              <button type="submit" class="btn btn-danger">
                <i class="fas fa-trash"></i> {% trans 'Xác nhận xóa' %}
              </button>
              <a href="{% url 'screening_contact_list' %}" class="btn btn-secondary">
                <i class="fas fa-times"></i> {% trans 'Hủy' %}
              </a>
            </div>
          </div>
        </form>
        
      </div>
    </div>
  </div>
</div>
{% endblock %}