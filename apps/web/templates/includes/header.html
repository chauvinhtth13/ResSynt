<!-- apps/web/templates/default/base.html -->
{% load static i18n %}

{% get_current_language as LANGUAGE_CODE %}

 <header class="sticky top-0 z-20 flex justify-between items-center gap-1 px-4 md:px-6 py-2 bg-white border-b border-gray-200 shadow-sm">
    <div class="flex items-center" >
        {% if request.study%}
            <button id="toggleSidebarBtn"
                    class="hidden md:inline-flex items-center rounded-2xl px-3 py-3 text-gray-700 hover:bg-gray-100 hover:text-blue-600 hover:ring-1 hover:ring-blue-600 transition"
                    aria-label="{% trans 'Hide sidebar' %}" aria-pressed="false" aria-controls="sidebar">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="size-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 5.25h16.5m-16.5 4.5h16.5m-16.5 4.5h16.5m-16.5 4.5h16.5" />
                </svg>
            </button>
        {% else %}
            <img src="{% static 'images/default/logo.webp' %}" alt="{% trans 'ResSync Logo' %}" class="h-10">
        {% endif %}
    </div>
    
    <div class="flex items-center gap-2">
        {% if request.study %}
        <button class="flex items-center rounded-2xl px-3 py-3 text-gray-700 hover:bg-gray-100 hover:text-blue-600 hover:ring-1 hover:ring-blue-600 focus:outline-none transition"
                aria-label="{% trans 'Notifications' %}">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="size-5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" />
            </svg>
        </button>

        <!-- Separator -->
        <div class="w-px bg-slate-200 mx-0 self-stretch"></div>
        {% endif %}
        <!-- Language Switcher -->
        <div class="relative" data-dropdown="language">
            <!-- Trigger -->
            <button
                id="lang-button"
                type="button"
                data-dropdown-trigger
                aria-haspopup="menu"
                aria-expanded="false"
                aria-controls="lang-menu"
                class="flex items-center gap-2 rounded-2xl px-3 py-3 text-gray-700 hover:bg-gray-100 hover:text-blue-600 ring-inset hover:ring-1 hover:ring-blue-600 transition"
            >
                <span class="sr-only">{% trans 'Select language' %}</span>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="size-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 0 1 7.843 4.582M12 3a8.997 8.997 0 0 0-7.843 4.582m15.686 0A11.953 11.953 0 0 1 12 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0 1 21 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0 1 12 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 0 1 3 12c0-1.605.42-3.113 1.157-4.418" />
                </svg>
                <span class="font-semibold text-sm tracking-wider uppercase">
                {% get_current_language as CURRENT_LANG %}{{ CURRENT_LANG|default:'vi' }}
                </span>
            </button>
            <!-- Menu -->
            <div
                id="lang-menu"
                role="menu"
                aria-labelledby="lang-button"
                data-dropdown-menu
                hidden
                class="absolute right-0 mt-2 min-w-[10em] rounded-xl border border-gray-200 bg-white shadow-lg ring-1 ring-black/5 focus:outline-none"
            >
                {% get_current_language as CURRENT_LANG %}
                {% get_available_languages as LANGS %}
                {% get_language_info_list for LANGS as languages %}
                <form method="post" action="{% url 'set_language' %}" class="m-2 space-y-1">
                    {% csrf_token %}
                    <input type="hidden" name="next" value="{{ request.path }}">
                    {% for lang in languages %}
                    {# lang.code, lang.name_local, lang.name, lang.bidi #}
                    <button
                        type="submit"
                        name="language"
                        value="{{ lang.code }}"
                        role="menuitemradio"
                        aria-checked="{% if lang.code == CURRENT_LANG %}true{% else %}false{% endif %}"
                        class="flex w-full items-center gap-0 px-3 py-2 text-sm rounded-md hover:ring-1 {% if lang.code == CURRENT_LANG %}font-semibold bg-blue-100{% endif %}"
                    >
                        <span class="inline-flex w-8 shrink-0 uppercase">{{ lang.code }}</span>
                        <span class="truncate">{{ lang.name_local|default:lang.name }}</span>
                    </button>
                    {% endfor %}
                </form>
            </div>
        </div>

        <!-- Separator -->
        <div class="w-px bg-slate-200 mx-0 self-stretch"></div>

        <!-- User Dropdown -->
        <div class="relative" data-dropdown="user">
            <button type="button" data-dropdown-trigger aria-haspopup="menu" aria-expanded="false" aria-controls="user-menu"
                    class="flex items-center gap-2 rounded-2xl px-3 py-3 text-gray-700 hover:bg-gray-100 hover:text-blue-600 hover:ring-1 hover:ring-blue-600 transition">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="size-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                </svg>
                <span id="username-display" class="font-semibold text-sm tracking-wider">{{ user.get_full_name|default:user.username }}</span>
            </button>
            <div id="user-menu" role="menu" aria-label="{% trans 'User menu' %}" data-dropdown-menu hidden class="absolute right-0 mt-2 min-w-[15em] rounded-xl border border-gray-200 bg-white shadow-lg ring-1 ring-black/5 focus:outline-none">
                {% if request.study %}
                <form method="post" action="{% url 'select_study' %}" data-choose-study-form class="m-1 space-y-1">
                    {% csrf_token %}
                    <input type="hidden" name="clear_study" value="1">
                    <button type="submit" class="flex items-center gap-2 px-3 py-2 text-sm text-blue-700 hover:bg-blue-50 rounded-md transition-colors duration-200 w-full text-left">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor" aria-hidden="true" class="h-5 w-5">
                            <path d="M240-200h120v-240h240v240h120v-360L480-740 240-560v360Zm-80 80v-480l320-240 320 240v480H520v-240h-80v240H160Zm320-350Z"/>
                        </svg>
                        {% trans "Chọn nghiên cứu khác" %}
                    </button>
                </form>
                
                <div class="h-px bg-slate-200 m-1 self-stretch"></div>
                {% endif %}
                <form method="post" action="{% url 'logout' %}" class="m-1 space-y-1">
                    {% csrf_token %}
                    <button type="submit" class="flex items-center gap-2 px-3 py-2 text-sm text-red-700 hover:bg-red-50 rounded-md transition-colors duration-200 w-full text-left">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor" aria-hidden="true" class="h-5 w-5">
                            <path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h280v80H200v560h280v80H200Zm440-160-55-58 102-102H360v-80h327L585-622l55-58 200 200-200 200Z"/>
                        </svg>
                        {% trans "Đăng xuất" %}
                    </button>
                </form>
            </div>
        </div>
    </div>
</header>