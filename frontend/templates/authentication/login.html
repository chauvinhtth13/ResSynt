{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}Sign In - ResSync Platform{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/default/authentication.css' %}" />
{% endblock %}

{% block main %}

<main class="row g-0">

    <!-- Features Section - Hidden on mobile, visible from lg -->
    <section class="col-lg-7 p-responsive d-none d-lg-flex flex-column justify-content-center bg-linear-gradient text-white">
        {% include 'includes/features_list.html' %}
    </section>

    <!-- Login Section -->
    <section class="col-12 col-lg-5 d-flex flex-column justify-content-between">
        <!-- header -->
        <div class="d-flex justify-content-end align-items-stretch pe-3 pt-3">
            <div class="dropdown">
                <button class="btn dropdown-toggle modern" type="button" id="languageDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    {% get_language_info for LANGUAGE_CODE as lang_info %}
                    {{ lang_info.name_local }}
                </button>
                <ul class="dropdown-menu language-menu" aria-labelledby="languageDropdown">
                    {% get_language_info_list for LANGUAGES as languages %}
                    {% for lang in languages %}
                    <li>
                        <form action="{% url 'set_language' %}" method="post" class="language-form">
                            {% csrf_token %}
                            <input name="next" type="hidden" value="{{ request.path }}">
                            <input name="language" type="hidden" value="{{ lang.code }}">
                            <button class="dropdown-item rounded {% if lang.code == LANGUAGE_CODE %}active{% endif %}" type="submit">
                                {{ lang.name_local }}
                            </button>
                        </form>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <div class="p-responsive d-flex flex-column justify-content-center">
        <!-- Title -->
        <div class="mb-4 text-center">
            <h2 class="fs-title-2 fw-bold mb-2">{% trans "Wellcome back" %}</h2>
            <div class="logo-wrapper">
                <img src="{% static 'images/default/logo.svg' %}" 
                    alt="ResSync Logo" 
                    height="50"
                    class="d-block mx-auto">
            </div>
        </div>

        {% if error_message %}
            <div class="alert 
                {% if error_type == 'wrong_password_first' %}alert-simple
                {% elif error_type == 'wrong_password_warning' %}alert-warning
                {% elif error_type == 'wrong_password_last' %}alert-critical
                {% elif error_type == 'permanently_blocked' %}alert-blocked
                {% elif error_type == 'user_not_found' %}alert-error
                {% elif error_type == 'suspended' or error_type == 'inactive' %}alert-info
                {% else %}alert-error{% endif %}">
                
                {% if error_type == 'permanently_blocked' %}
                    <strong>ðŸ”’ ACCOUNT LOCKED</strong><br>
                    {{ error_message }}
                {% else %}
                    {{ error_message }}
                {% endif %}
            </div>
        {% endif %}
        
        <!-- Django Messages -->
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        
        <!-- Login Form -->
        <form method="POST" id="loginForm">
            {% csrf_token %}

            <!-- Username/Email Input -->
            <div class="mb-4">
                <label class="form-label fs-5 fw-semibold" for="username">
                    <i class="bi bi-person-fill me-2 text-muted"></i> {% trans "Username or Email" %}
                </label>
                <input type="text" id="username" name="username"
                        class="form-control px-4 py-3 fs-5"
                        value="{{ form.username.value|default:'' }}"
                        placeholder="{% trans 'Enter username or email' %}" 
                        required autofocus>
            </div>
            
            <!-- Password Input -->
            <div class="mb-4">
                <label class="form-label fs-5 fw-semibold" for="password">
                    <i class="bi bi-lock-fill me-2 text-muted"></i> {% trans "Password" %}
                </label>
                <div class="password-input-container">
                    <input id="passwordInput" name="password" type="password"
                            class="form-control px-4 py-3 fs-5"
                            placeholder="{% trans 'Enter password' %}"
                            required autofocus>
                    <span class="password-toggle-icon" id="togglePassword">
                        <i class="bi bi-eye-slash fs-4" id="toggleIcon"></i>
                    </span>
                </div>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="btn btn-hover w-100 py-3 rounded-3 text-white fw-semibold mb-3 fs-5" id="submitBtn">
                <span id="btnText">{% trans "Sign In" %}</span>
            </button>
        </form>

        <!-- Forgot Password -->
        <div class="text-center">
            <a href="#" class="text-decoration-none fw-bold link-hover">
                {% trans "Forgot password?" %}
            </a>
        </div>
        </div>

        <!-- Footer -->
        <div class="text-center">
            <nav class="mb-2">
                <a href="/about" class="mx-3 text-decoration-none link-hover">About Us</a>
                <a href="/contact" class="mx-3 text-decoration-none link-hover">Contact</a>
            </nav>
            <p class="copyright-text text-muted">
                &copy; {% now "Y" %} {% trans 'ResSync. Designed by Chau Vinh & Pham Tuong Duy' %}
            </p>
        </div>

    </section>
</main>

{% endblock %}

{% block extra_js %}
<script src="{% static 'js/default/login.js' %}" defer></script>
{% endblock %}